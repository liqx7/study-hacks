# 登录与权限控制
## 内部登录
- 组件
	- 登录页
	- 主页
	- 登录状态判断（因为有随时可能的登出，超时等）
- 逻辑
	- 主页刷新或者调用接口都需要判断是否登录，在主页挂载的时候做一次登录判断，接口通过状态码判断触发
	- 登录-》主页-》登录判断（权限获取）-》登录这个链条没问题

## 有外部登录页面的
- 案例
	- xx行有统一登录页面，原有的两套系统有内部的登录与权限，因此只能在外部登录，登录返回的东西，在做一层系统登录授权，在进入功能
- 流程
	1.外部登录
	2.跳转到登录等待页
	3.调用接口获取授权信息
	4.拿到授权信息后判断
		1.符合授权，进入首页
		2.不合授权，显示无权，返回登录页
	5.主页判断登录与权限
		1.不合授权，跳转登录
		2.合授权，继续浏览
- 问题记录
	1.判断登录逻辑是两步，一是外部平台登录成功，二是内部鉴权接口
	2.主页的登录判断需要先判断是否已经有权限，走完两步，并且在鉴权成功后不作操作，失败才做操作
	3.登录等待页也要走两步，在鉴权成功后需要触发操作，失败同上一个
- 方案
	1.等待页的进入只可能是外部登录后的，因此我的处理方式是，无论当前怎样，都直接调用鉴权接口，不判断是否已经登录
	2.如果跟主页一样，先判断是否已有登录状态，需要在localStorage中同样存储每次登录后的状态，在调用接口前判断是否有以及存的token是否过期，本系统没有提供单纯的比较token方式，手动配置cookie，在统一登出操作的地方清除cookie，才可以将cookie视为登录期间，因此不适用

